%%%-------------------------------------------------------------------
%%% @author mb-spare
%%% @copyright (C) 2016, <COMPANY>
%%% @doc
%%%
%%% @end
%%% Created : 23. Feb 2016 3:23 PM
%%%-------------------------------------------------------------------
-module(test).
-author("mb-spare").

-include("../include/test_values.hrl").

%% API
-export([version/0,set_up/0,tear_down/0]).

%% @doc this is used to initialize for many tests
%% <p>it will also add the test agents</p>
-spec(set_up()-> Parent :: #agent{}).
set_up()->
  application:ensure_all_started(cqerl),
  archiver_sup:start_link(),
  expirable_sup:start_link(),
  query_runner:run_query(<<"truncate agent_by_phone_number;">>),
  query_runner:run_query(<<"truncate agent_by_country;">>),
  query_runner:run_query(<<"truncate account;">>),
  query_runner:run_query(<<"truncate child_count_by_agent_by_level;">>),
  query_runner:run_query(<<"truncate child_by_agent_by_level;">>),
  % parents's parent set
  Agent1 = #agent{
    agent_phone_number = <<"256771257290">>,
    parent_phone_number  = <<"chachap">>,
    parent_set = [],
    national_id = <<"1463233395">>,
    first_name = <<"agent2">>,
    last_name = <<"agent2">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },
  Agent2 = #agent{
    agent_phone_number = <<"256771257289">>,
    parent_phone_number  = <<"256771257290">>,
    parent_set = [{<<"256771257290">>, 1}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent2">>,
    last_name = <<"agent2">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },
  Agent3 = #agent{
    agent_phone_number = <<"256771257288">>,
    parent_phone_number  = <<"256771257289">>,
    parent_set = [
      {<<"256771257289">>, 1}, {<<"256771257290">>, 2}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent3">>,
    last_name = <<"agent3">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },
  Agent4 = #agent{
    agent_phone_number = <<"256771257287">>,
    parent_phone_number  = <<"256771257288">>,
    parent_set = [
      {<<"256771257288">>, 1},
      {<<"256771257289">>, 2}, {<<"256771257290">>, 3}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent4">>,
    last_name = <<"agent4">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },
  Agent5 = #agent{
    agent_phone_number = <<"256771257286">>,
    parent_phone_number  = <<"256771257287">>,
    parent_set = [
      {<<"256771257287">>, 1}, {<<"256771257288">>, 2},
      {<<"256771257289">>, 3}, {<<"256771257290">>, 4}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent5">>,
    last_name = <<"agent5">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },

  Agent6 = #agent{
    agent_phone_number = <<"256771257285">>,
    parent_phone_number  = <<"256771257286">>,
    parent_set = [
      {<<"256771257286">>, 1},
      {<<"256771257287">>, 2}, {<<"256771257288">>, 3},
      {<<"256771257289">>, 4}, {<<"256771257290">>, 5}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent6">>,
    last_name = <<"agent6">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },
  Agent7 = #agent{
    agent_phone_number = <<"256771257284">>,
    parent_phone_number  = <<"256771257285">>,
    parent_set = [
      {<<"256771257285">>, 1}, {<<"256771257286">>, 2},
      {<<"256771257287">>, 3}, {<<"256771257288">>, 4},
      {<<"256771257289">>, 5}, {<<"256771257290">>, 6}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent7">>,
    last_name = <<"agent7">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },

  Agent8 = #agent{
    agent_phone_number = <<"256771257283">>,
    parent_phone_number  = <<"256771257284">>,
    parent_set = [
      {<<"256771257284">>, 1},
      {<<"256771257285">>, 2}, {<<"256771257286">>, 3},
      {<<"256771257287">>, 4}, {<<"256771257288">>, 5},
      {<<"256771257289">>, 6}, {<<"256771257290">>, 7}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent8">>,
    last_name = <<"agent8">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },
  Agent9 = #agent{
    agent_phone_number = <<"256771257282">>,
    parent_phone_number  = <<"256771257283">>,
    parent_set = [
      {<<"256771257283">>, 1}, {<<"256771257284">>, 2},
      {<<"256771257285">>, 3}, {<<"256771257286">>, 4},
      {<<"256771257287">>, 5}, {<<"256771257288">>, 6},
      {<<"256771257289">>, 7}, {<<"256771257290">>, 8}
    ],
    national_id = <<"1463233395">>,
    first_name = <<"agent9">>,
    last_name = <<"agent9">>,
    date_of_birth = 4424234242, %% timestap
    password = <<"08*345gH#ch)01">>,
    security_question = <<"Who are you?">>,
    security_answer = <<"the mainest">>,
    next_of_kin_name = <<"kin">>,
    next_of_kin_relation = <<"kin">>,
    next_of_kin_phone_number = <<"256792388523">>,
    gender = <<"F">>,
    email = <<"test@local.com">>,
    country = <<"UGANDA">>,
    district = <<"Kampala">>,
    city = <<"ntinda">>,
    activated = false,
    blocked = false,
    network = <<"mtn">>,
    middle_name = <<"ye">>,
    licensed = false
  },

  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent1)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent2)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent3)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent4)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent5)) ,
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent6)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent7)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent8)),
  query_runner:run_batch(sync,cquery_builder:batch_insert_from_agent(Agent9)),
  [Agent1,Agent2,Agent3,Agent4,Agent5,Agent6,Agent7,Agent8,Agent9]
.


tear_down()->

  query_runner:run_query(<<"truncate agent_by_phone_number;">>),
  query_runner:run_query(<<"truncate agent_by_country;">>),
  query_runner:run_query(<<"truncate account;">>),
  query_runner:run_query(<<"truncate child_count_by_agent_by_level;">>),
  query_runner:run_query(<<"truncate child_by_agent_by_level;">>)

.

version()->
version_three.


